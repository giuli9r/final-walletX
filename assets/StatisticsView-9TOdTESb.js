import{_ as f,u as F,a as b,b as N,o as m,c as y,d as e,t as r,F as S,r as M,e as w,f as A}from"./index-_6ZDv-Gb.js";const C={data(){return{cryptoStore:F(),transactionStore:b(),loginStore:N(),wallet:[],totalWalletValue:0,totalWalletValueSellAll:0}},methods:{formatNumberFn(l){return this.cryptoStore.formatNumber(l)},async walletFn(){return await this.transactionStore.getHistory(this.getUsername)},calculateTotals(l){const t={};let p=0,c=0;const n=JSON.parse(localStorage.getItem("crypto-key")).cryptos,i=this.getBestBidPrice(n);return l.forEach(o=>{let a=o.action,s=o.crypto_code.toUpperCase(),d=a=="purchase"?parseFloat(o.crypto_amount):-parseFloat(o.crypto_amount),u=a=="sale"?parseFloat(o.money):-parseFloat(o.money);t[s]||(t[s]={totalMoney:0,totalCrypto:0,result_proftis:0});let h=s.toLowerCase(),g=i.filter(_=>_.hasOwnProperty(h))[0][h];t[s].totalMoney+=d*g,t[s].totalCrypto+=d,p+=u,t[s].result_proftis+=u}),Object.keys(t).forEach(o=>{c+=t[o].totalMoney}),Object.keys(t).forEach(o=>{const a=t[o].totalMoney/c*100;t[o].percentage=Math.abs(a.toFixed(2))}),{totals:t,totalMoney:p,totalMoneyAllSell:c}},getBestBidPrice(l){let t=Object.keys(l);console.log(t);const c=JSON.parse(localStorage.getItem("crypto-key")).cryptos,n=[];return t.forEach(i=>{let o={};const a=c[i]??{};let s=Number.MIN_VALUE,d="";Object.keys(a).forEach(u=>{a[u].totalBid>s&&a[u].totalBid!=0&&(s=a[u].totalBid,d=u)}),console.log(`Crypto ${i} de ${d} al mejor precio para la venta: ${s}`),o[i]=s,n.push(o)}),n??[]},async getHistory(){let l=await this.transactionStore.getHistory(localStorage.getItem("username"));this.wallet=l||[]}},computed:{getUsername(){return localStorage.getItem("username")??""},differenceMade(){let l=Math.abs(this.totalWalletValueSellAll),t=Math.abs(this.totalWalletValue);return l>t?l-t:t-l}},async mounted(){console.log("fetch transactions - IN PROGRESS....."),this.cryptoStore.fetchCryptosPrices(),console.log("fetch transactions data - DONE.");let l=await this.transactionStore.updateWalletFromServer(localStorage.getItem("username")),t=this.calculateTotals(l);this.wallet=t.totals,this.totalWalletValueSellAll=t.totalMoneyAllSell>=0?t.totalMoneyAllSell:0,this.totalWalletValue=t.totalMoney}},V={class:"container"},x={class:"crypto-table"},B={colspan:"3"},$={colspan:"3"},W={colspan:"3"};function v(l,t,p,c,n,i){return m(),y("div",V,[e("h1",null,r(this.getUsername)+"'s Wallet State",1),e("div",null,[e("table",x,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",null,"Crypto"),e("th",null,"Quantity"),e("th",null,"Last minute Fiat Amount"),e("th",null,"% Total Fiat Amount"),e("th",null,"Profit/Loss per Crypto")])],-1)),e("tbody",null,[(m(!0),y(S,null,M(this.wallet,(o,a)=>(m(),y("tr",{key:a},[e("td",null,r(a.toUpperCase()),1),e("td",null,r(this.formatNumberFn(o.totalCrypto.toFixed(4))),1),e("td",null,r(this.formatNumberFn(o.totalMoney.toFixed(2))),1),e("td",null,r(this.formatNumberFn(o.percentage))+"%",1),e("td",null,r(this.formatNumberFn(o.result_proftis.toFixed(2))),1)]))),128))]),e("tfoot",null,[e("tr",null,[t[0]||(t[0]=e("td",{colspan:"2"},[e("strong",null,"Total Fiat Value (if sold): ")],-1)),e("td",B,"$ "+r(this.formatNumberFn(n.totalWalletValueSellAll.toFixed(2))),1)]),e("tr",null,[t[1]||(t[1]=e("td",{colspan:"2"},[e("strong",null,"Current Fiat Balance: ")],-1)),e("td",$,"$ "+r(this.formatNumberFn(n.totalWalletValue.toFixed(2))),1)]),e("tr",null,[t[2]||(t[2]=e("td",{colspan:"2"},[e("strong",null,"Profit/Loss from Selling: ")],-1)),e("td",W,"$ "+r(this.formatNumberFn(i.differenceMade.toFixed(2))),1)])])])])])}const I=f(C,[["render",v],["__scopeId","data-v-78f74827"]]),P={components:{StatisticsComponent:I},data(){return{count:1,viewName:"Statistics"}},methods:{},mounted(){console.log(`The ${this.viewName} view  mounted.`)}};function E(l,t,p,c,n,i){const o=A("statistics-component");return m(),y(S,null,[e("h2",null,r(this.viewName)+" of transactions",1),w(o)],64)}const k=f(P,[["render",E],["__scopeId","data-v-6aec93f7"]]);export{k as default};
